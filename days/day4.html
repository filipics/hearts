<div id="day4" class="section">
            <div class="day-header">
                <h2>ðŸ‡§ðŸ‡ª â†’ ðŸ‡¬ðŸ‡§ Viernes 10 de Enero</h2>
                <p>London Day 1 â€¢ Museums â€¢ Churchill War Rooms â€¢ British Museum Night ðŸŒŸ</p>
            </div>

            <!-- MAP CARD -->
            <div class="route-map-card">
                <div class="route-map-preview">
                    <a href="https://www.google.com/maps/dir/Gare+de+Bruxelles-Midi,+Saint-Gilles,+Belgium/St+Pancras+International,+Euston+Road,+London,+UK/Natural+History+Museum,+Cromwell+Road,+London,+UK/Victoria+and+Albert+Museum,+Cromwell+Road,+London,+UK/Borough+Market,+London,+UK/Churchill+War+Rooms,+King+Charles+Street,+London,+UK/The+British+Museum,+Great+Russell+Street,+London,+UK" target="_blank" class="btn-route-map">
                        <i class="fas fa-map-marked-alt"></i> Ver Ruta en Google Maps
                    </a>
                </div>
                <div class="route-stats">
                    <span><i class="fas fa-train"></i> Eurostar + Tube</span>
                    <span><i class="fas fa-map-marker-alt"></i> 7 Paradas</span>
                </div>
            </div>

            <div class="day-rain-toggle">
                <label onclick="toggleRainMode()">
                    <i class="fas fa-cloud-rain"></i>
                    <span>Â¿Llueve hoy? Ver alternativas techadas</span>
                </label>
                <div class="rain-switch" id="rainSwitch4" onclick="toggleRainMode()"></div>
            </div>

            <div class="tip-box" style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-color: #F59E0B; margin-bottom: 20px;">
                <h4 style="color:#92400E;"><i class="fab fa-reddit"></i> London Reddit Consensus Day 1</h4>
                <p style="color:#78350F;">
                    Skipping tourist traps:<br>
                    âœ— London Eye (expensive) â†’ Sky Garden is FREE!<br>
                    âœ— Madame Tussauds (tourist trap)<br>
                    âœ— Oxford Street (crowded chaos)<br><br>
                    Reddit's TOP picks:<br>
                    âœ“ Churchill War Rooms (#1 paid attraction)<br>
                    âœ“ Natural History & V&A Museums (FREE & amazing)<br>
                    âœ“ Borough Market (best food)<br>
                    âœ“ British Museum at night (Friday until 20:30)
                </p>
            </div>


    <!-- 1. STATS HEADER -->
    <div class="day-stats-header">
        <div class="stat-pill">
            <i class="fas fa-clock"></i>
            <span id="total-time">0h</span>
            <small>Total</small>
        </div>
        <div class="stat-pill">
            <i class="fas fa-walking"></i>
            <span id="total-dist">Calc...</span>
            <small>Walking</small>
        </div>
        <div class="stat-pill">
            <i class="fas fa-euro-sign"></i>
            <span>$155</span>
            <small>Eurostar</small>
        </div>
    </div>

    <!-- 2. INTERACTIVE MAP -->
    <div class="interactive-map-container" id="mapContainerDay4">
        <div id="map-day4"></div>
        <button class="map-expand-btn" onclick="toggleMapSize()" title="Expandir mapa">
            <i class="fas fa-expand-alt"></i>
        </button>
    </div>

    <!-- RAIN TOGGLE -->
    <div class="day-rain-toggle">
        <label onclick="toggleRainMode()">
            <i class="fas fa-cloud-rain"></i>
            <span>Â¿Llueve hoy? Ver alternativas techadas</span>
        </label>
        <div class="rain-switch" id="rainSwitch4" onclick="toggleRainMode()"></div>
    </div>

    <!-- REDDIT TIP BOX -->
    <div class="tip-box" style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-color: #F59E0B; margin-bottom: 20px;">
        <h4 style="color:#92400E;"><i class="fab fa-reddit"></i> London Reddit Consensus Day 1</h4>
        <p style="color:#78350F;">
            Skipping tourist traps:<br>
            âœ— London Eye (expensive) â†’ Sky Garden is FREE!<br>
            âœ— Madame Tussauds (tourist trap)<br>
            âœ— Oxford Street (crowded chaos)<br><br>
            Reddit's TOP picks:<br>
            âœ“ Churchill War Rooms (#1 paid attraction)<br>
            âœ“ Natural History & V&A Museums (FREE & amazing)<br>
            âœ“ Borough Market (best food)<br>
            âœ“ British Museum at night (Friday until 20:30)
        </p>
    </div>

    <!-- 3. REORDERABLE ACTIVITY GRID -->
    <div id="activityGridDay4" class="activity-grid">

        <!-- ITEM 1: EUROSTAR BRUSSELS â†’ LONDON -->
        <div class="activity-block" data-id="eurostar-brussels-london" data-duration="130" data-lat="51.5320" data-lng="-0.1247" data-name="St Pancras Station">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-train"></i></div>
            </div>
            <div class="activity-block-title">Eurostar Brussels â†’ London</div>
            <div class="activity-block-subtitle">Arrives St Pancras 9:00 AM (130 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">High-speed train. Arrive 1 hour early. UK time is 1 hour behind Belgium. Get Oyster card at St Pancras for Tube transport (Â£2.70 fare cap).</p>
            </div>
        </div>

        <!-- ITEM 2: NATURAL HISTORY MUSEUM -->
        <div class="activity-block" data-id="natural-history" data-duration="120" data-lat="51.4967" data-lng="-0.1764" data-name="Natural History Museum">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-dinosaur"></i></div>
            </div>
            <div class="activity-block-title">Natural History Museum</div>
            <div class="activity-block-subtitle">Dinosaurs & architecture (120 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Reddit: Essential - FREE! Diplodocus skeleton, T-Rex, Blue Whale. Victorian masterpiece. Use Tube (Piccadilly line) from St Pancras.</p>
            </div>
        </div>

        <!-- ITEM 3: V&A MUSEUM -->
        <div class="activity-block" data-id="vam" data-duration="90" data-lat="51.4966" data-lng="-0.1722" data-name="V&A Museum">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-palette"></i></div>
            </div>
            <div class="activity-block-title">V&A Museum</div>
            <div class="activity-block-subtitle">Decorative arts variety (90 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Reddit: Best museum for variety & beauty. FREE! Fashion, sculpture, ceramics.</p>
            </div>
        </div>

        <!-- ITEM 4: BOROUGH MARKET -->
        <div class="activity-block" data-id="borough-market" data-duration="75" data-lat="51.5055" data-lng="-0.0909" data-name="Borough Market">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-utensils"></i></div>
            </div>
            <div class="activity-block-title">Borough Market</div>
            <div class="activity-block-subtitle">Best food market in London (75 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Reddit #1: 1000+ year old market. Fresh cheese, street food, pastries, wine.</p>
            </div>
        </div>

        <!-- ITEM 5: CHURCHILL WAR ROOMS -->
        <div class="activity-block" data-id="churchill-war-rooms" data-duration="120" data-lat="51.5015" data-lng="-0.1288" data-name="Churchill War Rooms">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-shield-alt"></i></div>
            </div>
            <div class="activity-block-title">Churchill War Rooms</div>
            <div class="activity-block-subtitle">WWII underground bunker (120 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Reddit: #1 paid attraction in London. Where Churchill ran WWII operations.</p>
            </div>
        </div>

        <!-- ITEM 6: BRITISH MUSEUM NIGHT -->
        <div class="activity-block" data-id="british-museum" data-duration="120" data-lat="51.5194" data-lng="-0.1270" data-name="British Museum">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-landmark"></i></div>
            </div>
            <div class="activity-block-title">British Museum Night</div>
            <div class="activity-block-subtitle">Rosetta Stone & mummies (120 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Reddit: World-class collection. Friday until 20:30 - much less crowded!</p>
            </div>
        </div>

        <!-- ITEM 7: TATE MODERN -->
        <div class="activity-block" data-id="tate-modern" data-duration="90" data-lat="51.5076" data-lng="-0.0994" data-name="Tate Modern">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-paint-brush"></i></div>
            </div>
            <div class="activity-block-title">Tate Modern</div>
            <div class="activity-block-subtitle">Modern art masterpieces (90 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">FREE modern art museum. Picasso, Dali, Warhol. Converted power station with great architecture.</p>
            </div>
        </div>

        <!-- ITEM 8: RETURN HOTEL -->
        <div class="activity-block" data-id="return-hotel" data-duration="30" data-lat="51.5155" data-lng="-0.0922" data-name="Hotel (End)">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-bed"></i></div>
            </div>
            <div class="activity-block-title">Regreso al Hotel</div>
            <div class="activity-block-subtitle">South Kensington</div>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Vuelta al hotel The Z Trafalgar.</p>
            </div>
        </div>

    </div>

    <script>
    (function() {
        // --- VARIABLES ---
        let map;
        let routeControl;
        const grid = document.getElementById('activityGridDay4');
        const mapContainer = document.getElementById('mapContainerDay4');

        // --- INIT ---
        setTimeout(() => {
            initMap();
            initSortable();
            updateScheduleAndRoute();
        }, 100);

        // --- 1. SCHEDULE LOGIC ---
        function updateScheduleAndRoute() {
            const blocks = Array.from(grid.children);
            let currentTime = 6.5 * 60; // Start 06:30 (6:30 AM)
            let waypoints = [];
            let totalDist = 0; // Approx distance

            blocks.forEach(block => {
                const duration = parseInt(block.dataset.duration) || 60;

                // Map Point Logic
                if (block.dataset.lat && block.dataset.lng) {
                    const lat = parseFloat(block.dataset.lat);
                    const lng = parseFloat(block.dataset.lng);
                    const name = block.dataset.name || "Stop";
                    waypoints.push({ latLng: L.latLng(lat, lng), name: name });
                }

                // Time Calculation
                const startH = Math.floor(currentTime / 60);
                const startM = currentTime % 60;

                currentTime += duration;

                const endH = Math.floor(currentTime / 60);
                const endM = currentTime % 60;

                const timeStr = `${String(startH).padStart(2,'0')}:${String(startM).padStart(2,'0')} - ${String(endH).padStart(2,'0')}:${String(endM).padStart(2,'0')}`;

                const badge = block.querySelector('.time-display');
                if(badge) badge.innerText = timeStr;

                currentTime += 15; // Travel buffer
            });

            updateRoute(waypoints);

            const endH = Math.floor(currentTime / 60);
            const totalHours = endH - 6.5;
            document.getElementById('total-time').innerText = `~${totalHours.toFixed(1)}h`;
        }

        // --- 2. MAP LOGIC ---
        function initMap() {
            if (mapContainer && !document.getElementById('map-day4')._leaflet_id) {
                map = L.map('map-day4').setView([51.5074, -0.1278], 11);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: 'OSM',
                    maxZoom: 20
                }).addTo(map);
            }
        }

        function updateRoute(points) {
            if (!map) return;
            if (routeControl) map.removeControl(routeControl);

            const waypoints = points.map(p => p.latLng);

            routeControl = L.Routing.control({
                waypoints: waypoints,
                routeWhileDragging: false,
                show: false,
                createMarker: function(i, wp, nWps) {
                    const name = points[i].name;
                    return L.marker(wp.latLng, {
                        draggable: false,
                        icon: L.divIcon({
                            className: 'custom-map-marker',
                            html: `<div class="marker-pin"></div><div class="marker-label">${name}</div>`,
                            iconSize: [30, 42],
                            iconAnchor: [15, 42]
                        })
                    });
                },
                lineOptions: {
                    styles: [{color: '#00D4FF', opacity: 0.8, weight: 6}]
                },
                addWaypoints: false,
                fitSelectedRoutes: true
            }).addTo(map);

            // Listen for route found to update distance stats
            routeControl.on('routesfound', function(e) {
                const routes = e.routes;
                const summary = routes[0].summary;
                // Convert meters to km
                const km = (summary.totalDistance / 1000).toFixed(1);
                const distEl = document.getElementById('total-dist');
                if(distEl) distEl.innerText = `${km} km`;
            });
        }

        // --- 3. SORTABLE ---
        function initSortable() {
            if (grid) {
                new Sortable(grid, {
                    animation: 150,
                    handle: '.activity-block-header',
                    ghostClass: 'sortable-ghost',
                    onEnd: function() { updateScheduleAndRoute(); }
                });
            }
        }

        // --- 4. MAP EXPAND ---
        window.toggleMapSize = function() {
            mapContainer.classList.toggle('expanded-map');
            setTimeout(() => {
                map.invalidateSize();
                // Re-fit bounds if expanded
                if(routeControl) {
                    // This is a bit hacky to re-center route
                    const waypoints = routeControl.getWaypoints();
                    // We just trigger a re-route calculation effectively or just let user zoom
                }
            }, 300);
        };

        window.toggleDetails = function(btn) {
            const container = btn.nextElementSibling;
            container.classList.toggle('open');
            if (container.classList.contains('open')) {
                btn.innerHTML = 'Ver menos <i class="fas fa-chevron-up"></i>';
            } else {
                btn.innerHTML = 'Ver detalles <i class="fas fa-chevron-down"></i>';
            }
        };
    })();
    </script>
</div>