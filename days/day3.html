<div id="day3" class="section">
            <div class="day-header">
                <h2>ðŸ‡§ðŸ‡ª Jueves 9 de Enero</h2>
                <p>ParÃ­s â†’ Bruselas â†’ DÃ­a en Brujas â†’ Noche en Bruselas</p>
            </div>

    <!-- 1. STATS HEADER -->
    <div class="day-stats-header">
        <div class="stat-pill">
            <i class="fas fa-clock"></i>
            <span id="total-time">0h</span>
            <small>Total</small>
        </div>
        <div class="stat-pill">
            <i class="fas fa-walking"></i>
            <span id="total-dist">Calc...</span>
            <small>Walking</small>
        </div>
        <div class="stat-pill">
            <i class="fas fa-euro-sign"></i>
            <span>$108</span>
            <small>Transport + Hotel</small>
        </div>
    </div>

    <!-- 2. INTERACTIVE MAP -->
    <div class="interactive-map-container" id="mapContainerDay3">
        <div id="map-day3"></div>
        <button class="map-expand-btn" onclick="toggleMapSize()" title="Expandir mapa">
            <i class="fas fa-expand-alt"></i>
        </button>
    </div>

    <!-- RAIN TOGGLE -->
    <div class="day-rain-toggle">
        <label onclick="toggleRainMode()">
            <i class="fas fa-cloud-rain"></i>
            <span>Â¿Llueve hoy? Ver alternativas techadas</span>
        </label>
        <div class="rain-switch" id="rainSwitch3" onclick="toggleRainMode()"></div>
    </div>

    <!-- 3. REORDERABLE ACTIVITY GRID -->
    <div id="activityGridDay3" class="activity-grid">

        <!-- ITEM 1: EUROSTAR PARIS â†’ BRUSSELS -->
        <div class="activity-block" data-id="eurostar-paris-brussels" data-duration="77" data-lat="50.8503" data-lng="4.3517" data-name="Brussels Station">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-train"></i></div>
            </div>
            <div class="activity-block-title">Eurostar Paris â†’ Brussels</div>
            <div class="activity-block-subtitle">Arrives 9:00 AM (77 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">High-speed train from Gare du Nord. Arrive 30 min early for check-in.</p>
            </div>
        </div>

        <!-- ITEM 2: TRAIN BRUSSELS â†’ BRUGES -->
        <div class="activity-block" data-id="train-brussels-bruges" data-duration="60" data-lat="51.1971" data-lng="3.2183" data-name="Bruges Station">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-train"></i></div>
            </div>
            <div class="activity-block-title">Train Brussels â†’ Bruges</div>
            <div class="activity-block-subtitle">Direct regional train (60 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">From Bruxelles-Midi to Bruges station. Every 20 minutes.</p>
            </div>
        </div>

        <!-- ITEM 3: MARKT SQUARE & BELFRY -->
        <div class="activity-block" data-id="markt-belfry" data-duration="90" data-lat="51.2086" data-lng="3.2242" data-name="Markt Square">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-landmark"></i></div>
            </div>
            <div class="activity-block-title">Markt Square & Belfry</div>
            <div class="activity-block-subtitle">Medieval heart of Bruges (90 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">366 steps to the top for best views. Belfry ticket ~14â‚¬, square is free.</p>
            </div>
        </div>

        <!-- ITEM 4: MINNEWATER & BEGIJNHOF -->
        <div class="activity-block" data-id="minnewater-begijnhof" data-duration="60" data-lat="51.2044" data-lng="3.2194" data-name="Minnewater">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-swimmer"></i></div>
            </div>
            <div class="activity-block-title">Minnewater & Begijnhof</div>
            <div class="activity-block-subtitle">"Lake of Love" & monastery (60 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Peaceful lake with swans and 13th-century monastery. Complete silence required.</p>
            </div>
        </div>

        <!-- ITEM 5: CANAL BOAT CRUISE -->
        <div class="activity-block" data-id="canal-cruise" data-duration="45" data-lat="51.2081" data-lng="3.2237" data-name="Rozenhoedkaai">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-ship"></i></div>
            </div>
            <div class="activity-block-title">Canal Boat Cruise</div>
            <div class="activity-block-subtitle">Bruges canals tour (45 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">From Rozenhoedkaai. Most famous view of the city. ~12â‚¬ per person.</p>
            </div>
        </div>

        <!-- ITEM 6: BELGIAN LUNCH -->
        <div class="activity-block" data-id="belgian-lunch" data-duration="90" data-name="Lunch">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-utensils"></i></div>
            </div>
            <div class="activity-block-title">Belgian Lunch</div>
            <div class="activity-block-subtitle">Moules-frites & local beer (90 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Try moules-frites, carbonnade, or waffles. Brugse Zot beer is local favorite.</p>
            </div>
        </div>

        <!-- ITEM 7: CHOCOLATE & FREE TIME -->
        <div class="activity-block" data-id="chocolate-free" data-duration="120" data-name="Chocolate Shops">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-cookie-bite"></i></div>
            </div>
            <div class="activity-block-title">Chocolate Route & Souvenirs</div>
            <div class="activity-block-subtitle">Free time exploring shops (120 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Best chocolates at The Chocolate Line. Try crazy flavors like bacon or wasabi!</p>
            </div>
        </div>

        <!-- ITEM 8: TRAIN BACK TO BRUSSELS -->
        <div class="activity-block" data-id="train-bruges-brussels" data-duration="60" data-lat="50.8503" data-lng="4.3517" data-name="Brussels">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-train"></i></div>
            </div>
            <div class="activity-block-title">Train Bruges â†’ Brussels</div>
            <div class="activity-block-subtitle">Return to Brussels (60 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Back to Bruxelles-Midi station for hotel check-in.</p>
            </div>
        </div>

        <!-- ITEM 9: HOTEL CHECK-IN & GRAND PLACE -->
        <div class="activity-block" data-id="grand-place" data-duration="180" data-lat="50.8466" data-lng="4.3525" data-name="Grand Place">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-building"></i></div>
            </div>
            <div class="activity-block-title">Hotel Check-in & Grand Place</div>
            <div class="activity-block-subtitle">Hotel Van Belle & illuminated square (180 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Gothic architecture at its finest. Magical when illuminated at night.</p>
            </div>
        </div>

    </div>

    <script>
    (function() {
        // --- VARIABLES ---
        let map;
        let routeControl;
        const grid = document.getElementById('activityGridDay3');
        const mapContainer = document.getElementById('mapContainerDay3');

        // --- INIT ---
        setTimeout(() => {
            initMap();
            initSortable();
            updateScheduleAndRoute();
        }, 100);

        // --- 1. SCHEDULE LOGIC ---
        function updateScheduleAndRoute() {
            const blocks = Array.from(grid.children);
            let currentTime = 7.5 * 60; // Start 07:30 (7:30 AM)
            let waypoints = [];
            let totalDist = 0; // Approx distance

            blocks.forEach(block => {
                const duration = parseInt(block.dataset.duration) || 60;

                // Map Point Logic
                if (block.dataset.lat && block.dataset.lng) {
                    const lat = parseFloat(block.dataset.lat);
                    const lng = parseFloat(block.dataset.lng);
                    const name = block.dataset.name || "Stop";
                    waypoints.push({ latLng: L.latLng(lat, lng), name: name });
                }

                // Time Calculation
                const startH = Math.floor(currentTime / 60);
                const startM = currentTime % 60;

                currentTime += duration;

                const endH = Math.floor(currentTime / 60);
                const endM = currentTime % 60;

                const timeStr = `${String(startH).padStart(2,'0')}:${String(startM).padStart(2,'0')} - ${String(endH).padStart(2,'0')}:${String(endM).padStart(2,'0')}`;

                const badge = block.querySelector('.time-display');
                if(badge) badge.innerText = timeStr;

                currentTime += 15; // Travel buffer
            });

            updateRoute(waypoints);

            const endH = Math.floor(currentTime / 60);
            const totalHours = endH - 7.5;
            document.getElementById('total-time').innerText = `~${totalHours.toFixed(1)}h`;
        }

        // --- 2. MAP LOGIC ---
        function initMap() {
            if (mapContainer && !document.getElementById('map-day3')._leaflet_id) {
                map = L.map('map-day3').setView([50.8503, 4.3517], 10);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: 'OSM',
                    maxZoom: 20
                }).addTo(map);
            }
        }

        function updateRoute(points) {
            if (!map) return;
            if (routeControl) map.removeControl(routeControl);

            const waypoints = points.map(p => p.latLng);

            routeControl = L.Routing.control({
                waypoints: waypoints,
                routeWhileDragging: false,
                show: false,
                createMarker: function(i, wp, nWps) {
                    const name = points[i].name;
                    return L.marker(wp.latLng, {
                        draggable: false,
                        icon: L.divIcon({
                            className: 'custom-map-marker',
                            html: `<div class="marker-pin"></div><div class="marker-label">${name}</div>`,
                            iconSize: [30, 42],
                            iconAnchor: [15, 42]
                        })
                    });
                },
                lineOptions: {
                    styles: [{color: '#00D4FF', opacity: 0.8, weight: 6}]
                },
                addWaypoints: false,
                fitSelectedRoutes: true
            }).addTo(map);

            // Listen for route found to update distance stats
            routeControl.on('routesfound', function(e) {
                const routes = e.routes;
                const summary = routes[0].summary;
                // Convert meters to km
                const km = (summary.totalDistance / 1000).toFixed(1);
                const distEl = document.getElementById('total-dist');
                if(distEl) distEl.innerText = `${km} km`;
            });
        }

        // --- 3. SORTABLE ---
        function initSortable() {
            if (grid) {
                new Sortable(grid, {
                    animation: 150,
                    handle: '.activity-block',
                    ghostClass: 'sortable-ghost',
                    onEnd: function() { updateScheduleAndRoute(); }
                });
            }
        }

        // --- 4. MAP EXPAND ---
        window.toggleMapSize = function() {
            mapContainer.classList.toggle('expanded-map');
            setTimeout(() => {
                map.invalidateSize();
                // Re-fit bounds if expanded
                if(routeControl) {
                    // This is a bit hacky to re-center route
                    const waypoints = routeControl.getWaypoints();
                    // We just trigger a re-route calculation effectively or just let user zoom
                }
            }, 300);
        };

        window.toggleDetails = function(btn) {
            const container = btn.nextElementSibling;
            container.classList.toggle('open');
            if (container.classList.contains('open')) {
                btn.innerHTML = 'Ver menos <i class="fas fa-chevron-up"></i>';
            } else {
                btn.innerHTML = 'Ver detalles <i class="fas fa-chevron-down"></i>';
            }
        };
    })();
    </script>
</div>