<div id="day2" class="section">
    <div class="day-header">
        <h2>üá´üá∑ Jueves 8 de Enero</h2>
        <p>Montmartre ‚Ä¢ Orangerie ‚Ä¢ Rodin ‚Ä¢ Canal Saint-Martin üåü Reddit Gems</p>
    </div>

    <!-- 1. STATS HEADER -->
    <div class="day-stats-header">
        <div class="stat-pill">
            <i class="fas fa-clock"></i>
            <span id="total-time">0h</span>
            <small>Total</small>
        </div>
        <div class="stat-pill">
            <i class="fas fa-walking"></i>
            <span id="total-dist">Calc...</span>
            <small>Walking</small>
        </div>
        <div class="stat-pill">
            <i class="fas fa-euro-sign"></i>
            <span>$133</span>
            <small>Hotel Cost</small>
        </div>
    </div>

    <!-- 2. INTERACTIVE MAP -->
    <div class="interactive-map-container" id="mapContainerDay2">
        <div id="map-day2"></div>
        <button class="map-expand-btn" onclick="toggleMapSize()" title="Expandir mapa">
            <i class="fas fa-expand-alt"></i>
        </button>
    </div>

    <!-- RAIN TOGGLE -->
    <div class="day-rain-toggle">
        <label onclick="toggleRainMode()">
            <i class="fas fa-cloud-rain"></i>
            <span>¬øLlueve hoy? Ver alternativas techadas</span>
        </label>
        <div class="rain-switch" id="rainSwitch2" onclick="toggleRainMode()"></div>
    </div>

    <!-- REDDIT TIP BOX -->
    <div class="tip-box" style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-color: #F59E0B; margin-bottom: 20px;">
        <h4 style="color:#92400E;"><i class="fab fa-reddit"></i> Reddit-Optimized Day</h4>
        <p style="color:#78350F;">
            Skipping tourist traps seg√∫n Reddit:<br>
            ‚úó Eiffel Tower ascent (long lines) ‚Üí Galeries Lafayette rooftop es gratis!<br>
            ‚úó Champs-√âlys√©es (just big brands) ‚Üí Canal Saint-Martin es m√°s local<br>
            ‚úì Montmartre at 8AM (beat the scammers)<br>
            ‚úì Mus√©e de l'Orangerie (Monet's Water Lilies)<br>
            ‚úì Rodin Museum (The Thinker + beautiful garden)
        </p>
    </div>

    <!-- 3. REORDERABLE ACTIVITY GRID -->
    <div id="activityGridDay2" class="activity-grid">

        <!-- ITEM 1: MONTMARTRE -->
        <div class="activity-block" data-id="montmartre" data-duration="150" data-lat="48.8867" data-lng="2.3431" data-name="Montmartre">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-church"></i></div>
            </div>
            <div class="activity-block-title">Montmartre & Sacr√©-C≈ìur</div>
            <div class="activity-block-subtitle">Early morning visit (150 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Reddit: Go at 8AM to beat crowds & scammers! Sacr√©-C≈ìur steps, bas√≠lica interior, artist streets.</p>
            </div>
        </div>

        <!-- ITEM 2: CAF√â DES DEUX MOULINS -->
        <div class="activity-block" data-id="cafe-amelie" data-duration="45" data-lat="48.8841" data-lng="2.3325" data-name="Caf√© Am√©lie">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-coffee"></i></div>
            </div>
            <div class="activity-block-title">Caf√© des Deux Moulins</div>
            <div class="activity-block-subtitle">Brunch from Am√©lie movie (45 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">From the movie "Am√©lie" - cozy, warm, authentic. 15 Rue Lepic.</p>
            </div>
        </div>

        <!-- ITEM 3: MUS√âE DE L'ORANGERIE -->
        <div class="activity-block" data-id="orangerie" data-duration="90" data-lat="48.8639" data-lng="2.3228" data-name="Mus√©e Orangerie">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-palette"></i></div>
            </div>
            <div class="activity-block-title">Mus√©e de l'Orangerie</div>
            <div class="activity-block-subtitle">Monet's Water Lilies (90 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Reddit: Monet's 8 massive Water Lilies panels in oval rooms - immersive and peaceful. ‚ö†Ô∏è CLOSED Jan 28-Mar 2, 2025 for renovations.</p>
            </div>
        </div>

        <!-- ITEM 4: RUE CLER MARKET -->
        <div class="activity-block" data-id="rue-cler" data-duration="60" data-lat="48.8567" data-lng="2.3078" data-name="Rue Cler Market">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-utensils"></i></div>
            </div>
            <div class="activity-block-title">Rue Cler Market Lunch</div>
            <div class="activity-block-subtitle">Fresh bread, cheese, wine (60 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Reddit: Perfect for picnic supplies. Pedestrian market street - warm shops!</p>
            </div>
        </div>

        <!-- ITEM 5: MUS√âE RODIN -->
        <div class="activity-block" data-id="rodin" data-duration="90" data-lat="48.8553" data-lng="2.3158" data-name="Mus√©e Rodin">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-gem"></i></div>
            </div>
            <div class="activity-block-title">Mus√©e Rodin</div>
            <div class="activity-block-subtitle">The Thinker + sculpture garden (90 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Reddit: Beautiful sculpture garden. Focus on indoor galleries in winter.</p>
            </div>
        </div>

        <!-- ITEM 6: CATACOMBS -->
        <div class="activity-block" data-id="catacombs" data-duration="90" data-lat="48.8343" data-lng="2.3322" data-name="Catacombs">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-skull"></i></div>
            </div>
            <div class="activity-block-title">Catacombs of Paris</div>
            <div class="activity-block-subtitle">6M skeletons in tunnels (90 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Reddit: Unique, macabre, "uniquely Paris". MUST book timed ticket online!</p>
            </div>
        </div>

        <!-- ITEM 7: DINNER -->
        <div class="activity-block" data-id="dinner" data-duration="45" data-name="Dinner">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-utensils"></i></div>
            </div>
            <div class="activity-block-title">Quick Dinner</div>
            <div class="activity-block-subtitle">Before Mus√©e d'Orsay (45 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Saint-Germain area or Rue du Bac. Eat near the museum. Try Le Comptoir du Relais (traditional French) or Il Brigante (Italian) in Saint-Germain.</p>
            </div>
        </div>

        <!-- ITEM 8: MUS√âE D'ORSAY -->
        <div class="activity-block" data-id="orsay" data-duration="105" data-lat="48.8600" data-lng="2.3266" data-name="Mus√©e d'Orsay">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-paint-brush"></i></div>
            </div>
            <div class="activity-block-title">Mus√©e d'Orsay Nocturno</div>
            <div class="activity-block-subtitle">Impressionist masterpieces (105 min)</div>
            <button class="expand-btn" onclick="toggleDetails(this)">Ver detalles <i class="fas fa-chevron-down"></i></button>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Reddit #1 museum. Monet, Van Gogh's Starry Night. Thursday night until 21:45!</p>
            </div>
        </div>

        <!-- RETURN HOTEL -->
        <div class="activity-block" data-id="return-hotel" data-duration="30" data-lat="48.8569" data-lng="2.3582" data-name="Hotel (End)">
            <div class="activity-block-header">
                <span class="activity-time-badge time-display">--:--</span>
                <div class="activity-icon-badge"><i class="fas fa-bed"></i></div>
            </div>
            <div class="activity-block-title">Regreso al Hotel</div>
            <div class="activity-block-subtitle">Le Marais</div>
            <div class="activity-details-container">
                <p style="font-size:0.85rem;">Vuelta al hotel WYLD Saint Germain.</p>
            </div>
        </div>

    </div>

    <script>
    (function() {
        // --- VARIABLES ---
        let map;
        let routeControl;
        const grid = document.getElementById('activityGridDay2');
        const mapContainer = document.getElementById('mapContainerDay2');

        // --- INIT ---
        setTimeout(() => {
            initMap();
            initSortable();
            updateScheduleAndRoute();
        }, 100);

        // --- 1. SCHEDULE LOGIC ---
        function updateScheduleAndRoute() {
            const blocks = Array.from(grid.children);
            let currentTime = 8 * 60; // Start 08:00
            let waypoints = [];
            let totalDist = 0; // Approx distance

            blocks.forEach(block => {
                const duration = parseInt(block.dataset.duration) || 60;

                // Map Point Logic
                if (block.dataset.lat && block.dataset.lng) {
                    const lat = parseFloat(block.dataset.lat);
                    const lng = parseFloat(block.dataset.lng);
                    const name = block.dataset.name || "Stop";
                    waypoints.push({ latLng: L.latLng(lat, lng), name: name });
                }

                // Time Calculation
                const startH = Math.floor(currentTime / 60);
                const startM = currentTime % 60;

                currentTime += duration;

                const endH = Math.floor(currentTime / 60);
                const endM = currentTime % 60;

                const timeStr = `${String(startH).padStart(2,'0')}:${String(startM).padStart(2,'0')} - ${String(endH).padStart(2,'0')}:${String(endM).padStart(2,'0')}`;

                const badge = block.querySelector('.time-display');
                if(badge) badge.innerText = timeStr;

                currentTime += 15; // Travel buffer
            });

            updateRoute(waypoints);

            const endH = Math.floor(currentTime / 60);
            const totalHours = endH - 8;
            document.getElementById('total-time').innerText = `~${totalHours}h`;
        }

        // --- 2. MAP LOGIC ---
        function initMap() {
            if (mapContainer && !document.getElementById('map-day2')._leaflet_id) {
                map = L.map('map-day2').setView([48.8606, 2.3376], 12);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: 'OSM',
                    maxZoom: 20
                }).addTo(map);
            }
        }

        function updateRoute(points) {
            if (!map) return;
            if (routeControl) map.removeControl(routeControl);

            const waypoints = points.map(p => p.latLng);

            routeControl = L.Routing.control({
                waypoints: waypoints,
                routeWhileDragging: false,
                show: false,
                createMarker: function(i, wp, nWps) {
                    const name = points[i].name;
                    return L.marker(wp.latLng, {
                        draggable: false,
                        icon: L.divIcon({
                            className: 'custom-map-marker',
                            html: `<div class="marker-pin"></div><div class="marker-label">${name}</div>`,
                            iconSize: [30, 42],
                            iconAnchor: [15, 42]
                        })
                    });
                },
                lineOptions: {
                    styles: [{color: '#00D4FF', opacity: 0.8, weight: 6}]
                },
                addWaypoints: false,
                fitSelectedRoutes: true
            }).addTo(map);

            // Listen for route found to update distance stats
            routeControl.on('routesfound', function(e) {
                const routes = e.routes;
                const summary = routes[0].summary;
                // Convert meters to km
                const km = (summary.totalDistance / 1000).toFixed(1);
                const distEl = document.getElementById('total-dist');
                if(distEl) distEl.innerText = `${km} km`;
            });
        }

        // --- 3. SORTABLE ---
        function initSortable() {
            if (grid) {
                new Sortable(grid, {
                    animation: 150,
                    handle: '.activity-block-header',
                    ghostClass: 'sortable-ghost',
                    onEnd: function() { updateScheduleAndRoute(); }
                });
            }
        }

        // --- 4. MAP EXPAND ---
        window.toggleMapSize = function() {
            mapContainer.classList.toggle('expanded-map');
            setTimeout(() => {
                map.invalidateSize();
                // Re-fit bounds if expanded
                if(routeControl) {
                    // This is a bit hacky to re-center route
                    const waypoints = routeControl.getWaypoints();
                    // We just trigger a re-route calculation effectively or just let user zoom
                }
            }, 300);
        };

        window.toggleDetails = function(btn) {
            const container = btn.nextElementSibling;
            container.classList.toggle('open');
            if (container.classList.contains('open')) {
                btn.innerHTML = 'Ver menos <i class="fas fa-chevron-up"></i>';
            } else {
                btn.innerHTML = 'Ver detalles <i class="fas fa-chevron-down"></i>';
            }
        };
    })();
    </script>
        </div>